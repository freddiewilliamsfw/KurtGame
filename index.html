<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
</head>
<body>
    <script>

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 1000,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
                }
    },
    cameras: {
        main: {
            height: 1000,
            width: 800
                }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const game = new Phaser.Game(config);

let player;
let platforms;
let protein;
let gameOver = false;
let ground;
let highestPlatformY = 950;
let score = 0;
let scoreText;

function preload() {
    this.load.image('ground', 'Assets/platform.png');
    this.load.image('dumbell', 'Assets/dumbell.png');
    this.load.image('kurt', 'Assets/kurt.png');
    this.load.image('protein', 'Assets/protein.png');
    this.load.image('background', 'Assets/background.png');
}

function create() {

    this.add.image(400, 500, 'background')

    platforms = this.physics.add.staticGroup();

    let startPlatform = platforms.create(100, 950, 'dumbell');

    // Set world bounds
    this.physics.world.setBounds(0, 0, 800, Number.MAX_SAFE_INTEGER);

    // Set up camera to follow player
    this.cameras.main.startFollow(player);
    this.cameras.main.setDeadzone(0, 200);
    
    // Add some floating platforms
    platforms.create(70, 120, 'dumbell');
    platforms.create(200, 200,'dumbell');    
    platforms.create(500, 331, 'dumbell');
    platforms.create(650, 400, 'dumbell');
    platforms.create(250, 800, 'dumbell');
    platforms.create(350, 700, 'dumbell');
    platforms.create(550, 600, 'dumbell');    
    platforms.create(200, 200,'dumbell');
    platforms.create(200, 450,'dumbell');

    // Create on-screen score
    scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#000' });
    scoreText.setScrollFactor(0); // This makes the text stay on screen
    
    // Player creation and physics
    player = this.physics.add.sprite(100, 850, 'kurt');
    player.setBounce(0.2);
    player.setCollideWorldBounds(true);

    // Create invisible ground
    ground = this.add.rectangle(400, 990, 800, 20, 0x000000);
    this.physics.add.existing(ground, true);

     // Program collisions
    this.physics.add.collider(player, ground, gameOverHandler, null, this);
    this.physics.add.collider(player, platforms);
    this.physics.add.overlap(player, protein, reachGoal, null, this);

    // Create the protein
    protein = this.physics.add.staticImage(50, 50, 'protein');
    
}

function generatePlatform(scene, y) {
    const x = Phaser.Math.Between(50, 750);
    return scene.physics.add.staticImage(x, y, 'dumbell');
}

function update() {
if (gameOver) {
        return;

}

    const cursors = this.input.keyboard.createCursorKeys();

    if (cursors.left.isDown) {
        player.setVelocityX(-160);
        player.setFlipX(true);  // Flip the sprite to face left
    } else if (cursors.right.isDown) {
        player.setVelocityX(160);
        player.setFlipX(false);  // Return the sprite to its original orientation
    } else {
        player.setVelocityX(0);
        // Optionally, you can add an idle animation or change the frame here
    }

    if (cursors.up.isDown && player.body.touching.down) {
        player.setVelocityY(-330);
    }
    
    // Generate new platforms as the camera moves up
     if (this.cameras.main.scrollY < highestPlatformY - 500) {
        const newPlatform = generatePlatform(this, highestPlatformY - 200);
        platforms.add(newPlatform);
        highestPlatformY -= 200;
    }

    // Remove platforms that are too low
    platforms.children.entries.forEach(platform => {
        if (platform.y > this.cameras.main.scrollY + 1100) {
            platforms.remove(platform, true, true);
        }
    
}
function reachGoal(player, protein) {
    console.log('reachGoal function called');
    score += 10;
    scoreText.setText('Score: ' + score);

    // Remove collected protein
    protein.disableBody(true, true);

    // Generate a new protein at a higher position
    const newProteinY = protein.y - Phaser.Math.Between(300, 500);
    const newProtein = this.physics.add.staticImage(
        Phaser.Math.Between(50, 750),
        newProteinY,
        'protein'
    );
    this.physics.add.overlap(player, newProtein, reachGoal, null, this);

    const glugText = this.add.text(400, player.y - 100, 'GLUG GLUG', {
        fontSize: '24px',
        fill: '#ff0000'
    });
    glugText.setOrigin(0.5);
    this.tweens.add({
        targets: glugText,
        alpha: 0,
        y: glugText.y - 50,
        duration: 1000,
        ease: 'Power2',
        onComplete: () => glugText.destroy()
    });
}

function gameOverHandler() {
    gameOver = true;
    this.physics.pause();
    player.setTint(0xff0000);

let gameOverText = this.add.text(400, 500, 'GAME OVER', { fontSize: '64px', fill: '#000' });
    gameOverText.setOrigin(0.5);

let restartButton = this.add.text(400, 600, 'Restart', { fontSize: '32px', fill: '#000' });
    restartButton.setOrigin(0.5);
    restartButton.setInteractive();
    restartButton.on('pointerdown', () => {
        gameOver = false;
        this.scene.restart();
    });
}


function displayGlugGlug() {
    const glugText = this.add.text(400, 500, 'GLUG GLUG', {
        fontSize: '64px',
        fill: '#ff0000',
        fontStyle: 'bold'
    });
    glugText.setOrigin(0.5);
    
    // Optional: Add a simple animation to make the text more eye-catching
    this.tweens.add({
        targets: glugText,
        scale: 1.2,
        duration: 500,
        yoyo: true,
        repeat: -1
    });

    // Optional: Add a restart button
    const restartButton = this.add.text(400, 600, 'Restart', {
        fontSize: '32px',
        fill: '#ffffff',
        backgroundColor: '#000000',
        padding: { x: 10, y: 5 }
    });
    restartButton.setOrigin(0.5);
    restartButton.setInteractive();
    restartButton.on('pointerdown', () => {
        this.scene.restart();
    });
}

function createColumn(x, rows, fontSize) {
    for (let j = 0; j < rows; j++) {
        let y = j * (fontSize + 5);
        let digit = Phaser.Math.Between(0, 9);
        let text = this.add.text(x, y, digit, { fontSize: `${fontSize}px`, fill: '#0f0' });
        
        this.tweens.add({
            targets: text,
            y: `+=${this.sys.game.config.height}`,
            duration: 5000,
            ease: 'Linear',
            repeat: -1,
            onUpdate: () => {
                text.setText(Phaser.Math.Between(0, 9));
            }
        });
    }
}

</script>
</body>
</html>
